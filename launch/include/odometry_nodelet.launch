<launch>

  <arg name="uav_name" default="$(optenv UAV_NAME uav)"/>
  <arg name="uav_mass" default="$(optenv UAV_MASS default)"/>
  <arg name="standalone" default="$(optenv STANDALONE false)"/>
  <arg name="profiler" default="$(optenv PROFILER false)" />
  <arg name="config_file" default=""/>
  <arg name="simulation" default="false" />
  <arg name="debug" default="false" />

  <arg unless="$(arg standalone)" name="nodelet" value="load"/>
  <arg     if="$(arg standalone)" name="nodelet" value="standalone"/>
  <arg unless="$(arg standalone)" name="nodelet_manager" value="$(arg uav_name)_nodelet_manager"/>
  <arg     if="$(arg standalone)" name="nodelet_manager" value=""/>

  <arg unless="$(arg debug)" name="launch_prefix" value=""/>
  <arg     if="$(arg debug)" name="launch_prefix" value="gdb -ex run --args"/>

  <arg name="pixgarm" default="$(optenv PIXGARM false)" />
  <arg unless="$(arg pixgarm)" name="range_topic" value="garmin/range" />
  <arg     if="$(arg pixgarm)" name="range_topic" value="mavros/distance_sensor/garmin" />

  <arg unless="$(arg simulation)" name="world_file" value="$(find mrs_general)/config/world_current.yaml" />
  <arg if="$(arg simulation)" name="world_file" value="$(find mrs_general)/config/world_simulation.yaml" />

  <arg unless="$(arg simulation)" name="default_config_file" value="$(find mrs_odometry)/config/uav/uav_default.yaml" />
  <arg if="$(arg simulation)" name="default_config_file" value="$(find mrs_odometry)/config/simulation/simulation_default.yaml" />

  <include file="$(find mrs_odometry)/launch/include/rtk_republisher_nodelet.launch" />

  <include file="$(find mrs_mavros_interface)/launch/mavros_interface.launch" />

  <include file="$(find mrs_mavros_interface)/launch/mavros_diagnostics.launch" />

  <group ns="$(arg uav_name)">

    <node pkg="nodelet" type="nodelet" name="odometry" args="$(arg nodelet) mrs_odometry/Odometry $(arg nodelet_manager)" output="screen" launch-prefix="$(arg launch_prefix)">

      <param name="enable_profiler" type="bool" value="$(arg profiler)" />

      <rosparam file="$(arg default_config_file)" command="load" />
      <rosparam file="$(find mrs_odometry)/config/state_estimators.yaml" command="load" />
      <rosparam file="$(find mrs_odometry)/config/altitude_estimator.yaml" command="load" />
      <rosparam file="$(find mrs_odometry)/config/heading_estimator.yaml" command="load" />
      <rosparam file="$(arg config_file)" />
      <rosparam file="$(arg world_file)" />

      <!-- parameter -->
      <param name="uav_name" type="string" value="$(arg uav_name)"/>
      <param name="uav_mass" type="double" value="$(arg uav_mass)"/>
      <param name="simulation" type="bool" value="$(arg simulation)"/>
      <param name="use_gt_orientation" type="bool" value="false"/>

      <!-- Subscribers -->
      <remap from="~target_attitude_in" to="mavros/setpoint_raw/attitude" />
      <remap from="~pixhawk_imu_in" to="mavros/imu/data" />
      <remap from="~control_acc_in" to="mavros/imu/data" />
      <remap from="~pixhawk_compass_in" to="mavros/global_position/compass_hdg" />
      <remap from="~pixhawk_odom_in" to="mavros_interface/converted_mavros_odom" />
      <remap from="~optflow_in" to="optic_flow/velocity" />
      <remap from="~optflow_stddev_in" to="optic_flow/velocity_stddev" />
      <remap from="~vio_in" to="ground_truth" />
      <remap from="~t265_odom_in" to="ground_truth" />
      <remap from="~brick_pose_in" to="wall_grasping/current_target_uav_odom" />
      <remap from="~vio_state_in" to="orb_slam/tracking_state" />
      <remap from="~teraranger_in" to="teraranger/range" />
      <remap from="~garmin_in" to="$(arg range_topic)" />
      <remap from="~global_position_in" to="mavros/global_position/global" />
      <remap from="~hector_pose_in" to="hector_mapping/slam_out_pose" />
      <remap from="~tracker_status_in" to="control_manager/tracker_status" />
      <remap from="~rtk_gps_in" to="rtk_gps/global" />
      <remap from="~icp_relative_in" to="lidar_stabilization/odom" />
      <remap from="~icp_absolute_in" to="forest_slam/odom_corr_global" />
      <remap from="~ground_truth_in" to="ground_truth" />
      <remap from="~mavros_diagnostic_in" to="mavros_interface/diagnostics" />

      <!-- Publishers -->
      <remap from="~odom_main_out" to="~odom_main" />
      <remap from="~odom_stable_out" to="~odom_stable" />
      <remap from="~odom_optflow_out" to="~odom_optflow" />
      <remap from="~odom_gps_out" to="~odom_gps" />
      <remap from="~odom_optflowgps_out" to="~odom_optflowgps" />
      <remap from="~odom_object_out" to="~odom_object" />
      <remap from="~slow_odom_out" to="~slow_odom" />
      <remap from="~esp_odom_out" to="~esp_odom" />
      <remap from="~rtk_local_out" to="~rtk_local" />
      <remap from="~rtk_local_odom_out" to="~rtk_local_odom" />
      <remap from="~gps_local_odom_out" to="~gps_local_odom" />
      <remap from="~odometry_diag_out" to="~diagnostics" />
      <remap from="~altitude_out" to="~altitude" />
      <remap from="~altitude_state_out" to="~altitude_state" />
      <remap from="~max_altitude_out" to="~max_altitude" />
      <remap from="~orientation_out" to="~orientation" />
      <remap from="~lkf_states_x_out" to="~lkf_states_x" />
      <remap from="~lkf_states_y_out" to="~lkf_states_y" />
      <remap from="~orientation_gt_out" to="~orientation_gt" />
      <remap from="~orientation_mavros_out" to="~orientation_mavros" />
      <remap from="~orientation_target_out" to="~orientation_target" />
      <remap from="~compass_yaw_out" to="~compass_yaw" />
      <remap from="~profiler" to="profiler" />

      <!-- Services -->
      <remap from="~average_current_position_in" to="~average_current_position" />
      <remap from="~toggle_garmin_in" to="~toggle_garmin" />
      <remap from="~toggle_rtk_altitude_in" to="~toggle_rtk_altitude" />
      <remap from="~change_estimator_type_in" to="~change_estimator_type" />
      <remap from="~change_estimator_type_string_in" to="~change_estimator_type_string" />
      <remap from="~change_hdg_estimator_type_in" to="~change_hdg_estimator_type" />
      <remap from="~change_hdg_estimator_type_string_in" to="~change_hdg_estimator_type_string" />
      <remap from="~reset_lateral_kalman_in" to="~reset_lateral_kalman" />

    </node>

  </group>

</launch>
